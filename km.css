/* ---------------------------------------------------------------------------
   1. TOKENS: Variables for everything 
   ------------------------------------------------------------------------ */
@layer tokens {
  :root {
    /* ===== Core colours (6 hexes) ===== */
    --color-main: rgb(29, 29, 29); /* page background        */
    --color-accent: #3fabd1; /* links, active UI       */
    --color-shadow: rgb(0, 0, 0); /* backdrop and shadows   */

    /* ===== Derived shades (no new hex codes) ===== */
    --color-text: color( from var(--color-main) display-p3 calc(1 - r) calc(1 - g) calc(1 - b));
    --color-backdrop: color-mix(in srgb,         var(--color-main)   80%, transparent);
    --color-lowest-contrast: color-mix(in srgb,  var(--color-text)    6%, var(--color-main));
    --color-low-contrast: color-mix(in srgb,     var(--color-text)   12%, var(--color-main));
    --color-quarter-contrast: color-mix(in srgb, var(--color-text)   25%, var(--color-main));
    --color-mid-contrast: color-mix(in srgb,     var(--color-text)   65%, var(--color-main));
    --color-accent-quarter: color-mix(in srgb,   var(--color-accent) 25%, var(--color-quarter-contrast));
    --color-accent-mid: color-mix(in srgb,       var(--color-accent) 50%, var(--color-quarter-contrast));
    --color-accent-3quarter: color-mix(in srgb,  var(--color-accent) 75%, var(--color-quarter-contrast));

    /* ===== Alerts ===== */
    --important: #8c88e5;
    --note: #30b1ea;
    --tip: #59c335;
    --warning: #ddaa26;
    --caution: #f87171;

    /* ===== Radii & rhythm ===== */
    --r-sm: 4px; /*  for content blocks */
    --r-md: 8px; /*  for UI blocks      */

    --g-xs: 0.15rem;
    --g-sm: 0.3rem;
    --g-md: 0.6rem;
    --g-lg: 1.2rem;

    /* ===== Layout constants ===== */
    --w-sidebar: 290px;
    --w-util: 290px;
    --h-header: 48px;

    /* ===== Z-levels ===== */
    --z-ground: 2;
    --z-mid: 3;
    --z-sky: 4;
  }
}

/* ---------------------------------------------------------------------------
     2. RESET: minimal & opinionated
     ------------------------------------------------------------------------ */
@layer reset {
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  html {
    position: fixed;
    width: 100%;
  }

  body {
    margin: 0;
    display: flex;
    height: 100dvh;
    overflow: hidden;
    font-family: system-ui, Segoe UI, Roboto, sans-serif;
    background: var(--color-main);
    color: var(--color-text);
    font-size: 1rem;
    line-height: 1.5;
  }
    
  a { text-decoration: none; }
    
             h6 { font-size: clamp(1rem,    0.98rem + 0.20vw, 1.125rem); }      /* 16    → ~18px */
             h5 { font-size: clamp(1.08rem, 1.00rem + 0.30vw, 1.25rem); }       /* ~17.3 → 20px */
             h4 { font-size: clamp(1.16rem, 1.05rem + 0.40vw, 1.375rem); }      /* ~18.6 → 22px */
             h3 { font-size: clamp(1.28rem, 1.10rem + 0.55vw, 1.5rem); }        /* ~20.5 → 24px */
             h2 { font-size: clamp(1.44rem, 1.20rem + 0.75vw, 1.75rem); }       /* ~23   → 28px */
    #content h1 { font-size: clamp(1.6rem,  1.30rem + 1vw,    2rem); }          /* 25.6  → 32px */

}

/* ----------------------------------------------------------------------------------------
     3. UI: sidebar • breadcrumbs dropdown header • util column • prev/next • graph • ToC
     ------------------------------------------------------------------------------------- */
@layer layout {
  #graph-box,
  #toc {
    z-index: var(--z-ground);
  }

  /* Keep the icon and text nicely aligned */
  #wiki-title {
    display: flex;
    align-items: center;
    gap: var(--g-md);
  }

  #wiki-favicon {
    width: calc(var(--g-lg) * 2); /* scales with font-size */
    height: calc(var(--g-lg) * 2);
  }

  #crumb svg,
  #crumb line {
    fill: var(--color-mid-contrast);
    stroke: var(--color-mid-contrast);
  }

  /* ─── theme toggle ───────────────────────────────────── */
  .theme-toggle {
    display: flex;
    border: 0;
    cursor: pointer;
    margin-left: auto;
    transition: 0.3s ease !important;
    padding: var(--g-md) var(--g-md);
    background: linear-gradient(
      to right,
      transparent 0,
      var(--color-lowest-contrast) var(--g-md)
    );
  }

  .theme-toggle svg {
    transition: 0.3s ease !important;
  }

  /* simple cross-fade */
  .theme-toggle .sun {
    opacity: 1;
    transform: scale(1) rotate(40deg) translate(15px, -11px);
  }
  .theme-toggle .moon {
    opacity: 0.3;
    transform: scale(0.5) rotate(180deg) translate(40px, 5px);
  }

  html[data-theme="dark"] .theme-toggle .sun {
    opacity: 0.3;
    transform: scale(0.7) rotate(0deg) translate(3px, -3px);
  }

  html[data-theme="dark"] .theme-toggle .sun line {
    opacity: 0;
  }

  html[data-theme="dark"] .theme-toggle .moon {
    opacity: 1;
    transform: scale(1) translate(-4px, 2px);
  }

  html[data-theme="light"] .theme-toggle:has(.sun) {
    transform: rotate(0deg);
  }

  html[data-theme="dark"] .theme-toggle:has(.moon) {
    transform: rotate(0deg);
  }

  #sidebar {
    width: var(--w-sidebar);
    background: var(--color-lowest-contrast);
    border-right: 1px solid var(--color-low-contrast);
    flex-direction: column;
    max-height: 100vh; /* keep it inside the viewport */
    padding: 0 var(--g-sm);
    overflow-y: auto;
  }

  /* Remove default left padding on nested nav lists */
  #sidebar ul,
  #toc ul {
    padding-left: var(--g-xs);
  }

  /* Nav list */
  #sidebar ul {
    list-style: none;
    margin: 0;
  }
  #sidebar li {
    margin: var(--g-xs) 0;
  }
  #sidebar .article {
    padding-left: var(--g-sm);
  }  

  #sidebar a {
    color: var(--color-text);
    text-decoration: none;
  }
  #sidebar a:hover {
    color: var(--color-accent);
  }

  /* Expand / collapse caret */
  .caret {
    font-size: 1.2em;
    display: inline-block;
    color: var(--color-mid-contrast);
    background: none;
    border: none;
    cursor: pointer;
  }

  .group-sep {
   padding: var(--g-xs);
  }

  .caret::before {
    content: "▸";
  }
  .folder.open > .caret {
    transform: rotate(90deg);
  }

  /* Vertical “tree trunk” (also reused by blockquote) */
  #sidebar ul ul,
  blockquote {
    position: relative;
    padding-left: var(--g-lg);
  }
    
    .sidebar-current {
        cursor: unset;
    }  

  #sidebar ul ul::before,
  blockquote::before {
    content: "";
    position: absolute;
    top: var(--g-xs);
    bottom: 0;
    left: calc(var(--g-md) * 1.26);
    width: 3px;
    background: var(--color-mid-contrast);
    opacity: 0.6;
    border-radius: var(--r-sm);
  }
  
 blockquote::before {
    left: var(--g-xs);
  }  
    
  #tree,
  #results {
    flex: 1 1 auto; /* stretches to fill remaining space */
    overflow-y: auto;
    overscroll-behavior: contain; /* stops “rubber-band” on mobile */
  }

  #results .heading-result a{
    color: var(--color-mid-contrast);
    font-size: 0.85em;
    cursor: pointer;
  }

  /* Search input */
  #search {
    width: 100%;
    margin-bottom: var(--g-sm);
    padding: var(--g-sm) var(--g-md);

    background: var(--color-main);
    color: var(--color-text);

    border: 1px solid var(--color-low-contrast);
    border-radius: var(--r-sm);
  }

  /* Search-box utilities (merged from old Section 8) */
  #search-box {
    position: relative;
  }

  #search-clear {
    position: absolute;
    top: 40%;
    right: var(--g-md);
    transform: translateY(-50%);

    border: none;
    background: none;
    padding: 0;

    font: inherit;
    line-height: 1;
    color: var(--color-mid-contrast);
    cursor: pointer;
  }

  #no_result {
    opacity: 0.6;
    cursor: default;
  }
    
  #results li a:hover {
    color: var(--color-accent);
  }

  /* ===== Main column ===== */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* ===== Content vs util split ===== */
  #content-area {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  /* Article */
  #content {
    flex: 1;
    padding: var(--g-lg) calc(var(--g-lg) * 2);
    overflow-y: auto;
  }

  /* Prev / next pager */
  #prev-next {
    display: flex;
    justify-content: space-between;
    margin-block: calc(var(--g-lg) * 2);
  }

  #prev-next a {
    background: var(--color-lowest-contrast);
    color: var(--color-text) !important;

    padding: var(--g-sm) var(--g-lg);
    border-radius: var(--r-sm);
    text-decoration: none;
  }

  #prev-next a:hover {
    background: var(--color-low-contrast);
    color: var(--color-accent) !important;
  }

  /* ===== Header / breadcrumb ===== */
  #crumb {
    height: var(--h-header);
    background: var(--color-lowest-contrast);
    display: flex;
    align-items: center;
    transform: translate(-4px);
    margin-right: -4px;
    padding-left: 4px;
    border-bottom: solid 1px var(--color-low-contrast);
    z-index: var(--z-mid);
    max-width: 101dvw;
  }

  #crumb a {
    color: var(--color-text);
    text-decoration: none;
    padding: var(--g-sm) var(--g-md);
    border-radius: var(--r-sm);
  }

  /* Classic breadcrumb pill */
  #crumb a:not(#home-link):hover,
  .crumb-current {
    background: var(--color-low-contrast);
  }
  .separator {
    margin: 0 var(--g-sm);
  }

  /* Breadcrumb dropdowns */
  #crumb .dropdown ul,
  #crumb .childbox ul {
    display: none;
    position: absolute;
    left: 0;
    top: 100%;

    margin: 0;
    padding: var(--g-xs) 0;
    list-style: none;

    background: var(--color-lowest-contrast);
    border: 1px solid var(--color-low-contrast);
    border-radius: var(--r-sm);
    z-index: var(--z-sky);
  }

  /* Keep open on hover */
  #crumb .dropdown:hover ul,
  #crumb .dropdown ul:hover,
  #crumb .childbox:hover ul,
  #crumb .childbox ul:hover {
    display: block;
  }

  #crumb .dropdown ul li,
  #crumb .childbox ul li {
    padding: var(--g-xs) var(--g-md);
    white-space: nowrap;
    cursor: pointer;
  }

  #crumb .dropdown ul li:hover,
  #crumb .childbox ul li:hover {
    background: var(--color-low-contrast);
  }

  .dropdown {
    position: relative;
  }
  .childbox {
    position: relative;
    cursor: pointer;
  }
  .childbox .toggle {
    padding: var(--g-sm);
    margin-left: var(--g-xs);
  }

  /* Util column */
  #util {
    width: var(--w-util);
    background: var(--color-main);

    padding: var(--g-md) var(--g-md) var(--g-md) 0;
    display: flex;
    flex-direction: column;
    gap: var(--g-xs);
  }

  /* Mini-graph box */
  #graph-box {
    position: relative;
    height: calc(var(--w-util) - calc(var(--g-lg) * 2));

    background: var(--color-lowest-contrast);
    border: 1px solid var(--color-low-contrast);
    border-radius: var(--r-md);
  }

  #graph-box:has(.fullscreen) {
    position: fixed !important;
    inset: 0;
    width: 100vw;
    height: 100vh !important;
    background: var(--color-backdrop) !important;
    border: none !important;
    z-index: var(--z-sky);
    border-radius: unset;
    backdrop-filter: blur(2px);
  }

  /* Magnifier button */
  #expand {
    top: var(--g-sm);
    right: var(--g-sm);
    color: var(--color-mid-contrast);
    font-size: calc(var(--g-lg) * 1.5);
    margin-top: calc(var(--g-sm) * -1);
    font-weight: bolder;
    position: absolute;
    border: none;
    background: radial-gradient(
      var(--color-lowest-contrast) var(--g-md),
      transparent var(--g-lg)
    );
    cursor: pointer;
  }
  
    .fullscreen + #expand  {
      background: radial-gradient(
      var(--color-main) var(--g-md),
      transparent var(--g-lg)
    );
    }

  #graph_text {
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none; /* IE 10 and IE 11 */
    user-select: none; /* Standard syntax */
  }

  #graph-box:has(.fullscreen) > #expand {
    font-size: calc(var(--g-lg) * 3);
  }

  #graph-box svg {
    width: 100%;
    height: 100%;
  }
  
  #graph-box circle:not(#node_current) {
    cursor: pointer;        
  }
    
   #content h1, #content h2, #content h3, #content h4, #content h5, #content h6 {
    cursor: pointer;        
  }
  
  #see-also h2 {
        cursor: unset
  }
    
  /* ─── graph colour theme (SVG) ─── */
  #node_current {
    fill: var(--color-accent);
  }
  #node_parent {
    fill: var(--color-mid-contrast);
  }
  #node_leaf {
    fill: var(--color-quarter-contrast);
  }

  #link_tag1 {
    stroke: var(--color-accent-quarter);
    stroke-width: 1px;
  }
  #link_tag2 {
    stroke: var(--color-accent-mid);
    stroke-width: 2px;
  }
  #link_tag3 {
    stroke: var(--color-accent-3quarter);
    stroke-width: 3px;
  }

  #link_hier1,
  #link_hier2,
  #link_hier3,
  #link_hier4,
  #link_hier5 {
    stroke: var(--color-mid-contrast);
  }
    
  #link_hier1 {
    stroke-width: 1px;
  }
    
  #link_hier2 {
    stroke-width: 2px;
  }
    
  #link_hier3 {
    stroke-width: 3px;
  }
    
  #link_hier4 {
    stroke-width: 4px;
  }
    
  #link_hier5 {
    stroke-width: 5px;
  }

  #graph_text {
    fill: var(--color-text);
  }

  /* ─── “current” node emphasis ─── */
  #graph_text.current {
    font-size: 14px;
    font-weight: 600;
  }

  .watermark {
    z-index: var(--z-mid);
  }
  a.watermark {
    display: block;
    text-align: center;
    color: var(--color-quarter-contrast);
    font-size: calc(var(--g-md) * 1.4);
  }

  /* Table-of-Contents */
  #toc {
    flex: 1;
    background: var(--color-lowest-contrast);

    border: 1px solid var(--color-low-contrast);
    border-radius: var(--r-md);
    padding-left: var(--g-sm);
    overflow: auto;
  }
  #toc li[data-level="2"] {
    padding-left: 14px;
  }
  #toc li[data-level="3"] {
    padding-left: 28px;
  }

  #toc a {
    text-decoration: none;
    color: var(--color-text);
  }

  #toc ul li:first-child {
    color: var(--color-mid-contrast);
    text-align: center;
    padding-bottom: var(--g-md);
  }

  #toc ul li:first-child a {
    color: var(--color-mid-contrast);
  }

  #toc a:hover {
    color: var(--color-accent) !important;
  }
}

/* ---------------------------------------------------------------------------
     4. CONTENT: md and populated content
     ------------------------------------------------------------------------ */
@layer content {
  p {
    text-align: left;
  }

  #content h1,
  #content h2,
  #content h3,
  #content h4,
  #content h5,
  #content h6,{
    scroll-margin-top: calc(var(--g-lg) * 2);
  }

  #content a {
    color: var(--color-accent);
  }
  #content a:hover {
    color: var(--color-text);
  }

  /* ===== Tables – original look restored ===== */
  table {
    width: auto;
    background: var(--color-lowest-contrast);
    padding: 1px;
    border-radius: var(--r-sm);
  }

  th,
  td {
    padding: var(--g-sm);
  }
  th {
    background: var(--color-lowest-contrast);
  }
  td {
    background: var(--color-main);
  }

  img {
    max-width: 100%;
    border-radius: var(--r-sm);
  }
  hr {
    height: var(--g-sm);
    border: none;
    background: var(--color-low-contrast);
    border-radius: var(--r-sm);
  }

  /* Typography & code */
  blockquote {
    color: var(--color-mid-contrast);
  }
  summary:hover {
    color: var(--color-accent);
  }

pre,.katex-display {
  width: fit-content;
  max-width: 100%;
}

code {
  background: var(--color-lowest-contrast) !important;
  padding: 0 var(--g-xs);
  border-radius: var(--r-sm);
}
    
details code, details .katex-html {
  background-color: var(--color-low-contrast) !important;
}  

pre code {
  text-wrap-mode: nowrap;
  overflow-x: scroll;
  padding-right: calc(var(--g-lg) * 2) !important;
}
    
pre {
  border-radius: var(--r-sm);
  position: relative;
  margin-right: -100dvh; 
}
  
details {
  background: var(--color-lowest-contrast);
  padding: var(--g-md) var(--g-lg);
  border-radius: var(--r-sm);
  width: fit-content;
  max-width: 100%;
}

details[open] pre:has(code)::after, pre:has(code)::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 10%;
  height: 100%;
  background: linear-gradient(to left, var(--color-low-contrast), var(--g-lg), transparent);
  pointer-events: none;
  border-radius: var(--r-sm);
}
    
pre:has(code)::after {
  background: linear-gradient(to left, var(--color-lowest-contrast), var(--g-lg), transparent);
}    


  iframe {
    width: 50dvw;
    height: auto;
    max-width: 100%;
    min-width: 200px;
    aspect-ratio: 1.777778;
    resize: both;
    border: none;
    border: solid 1px var(--color-low-contrast);
    border-radius: var(--r-sm);
    padding: calc(var(--g-sm) * 1.6);
    background: var(--color-lowest-contrast);
  }

  .katex-display .katex-html {
    text-align: left;
    padding: var(--g-lg);
    background: var(--color-lowest-contrast) !important;
    border-radius: var(--r-sm);
    max-width: max-content;
  }

  /* Checkbox patch */
  input[type="checkbox"] {
    width: var(--g-lg);
    height: var(--g-lg);
    vertical-align: calc(var(--g-xs) * -1.5);
    filter: brightness(1.2) contrast(1.5);
  }
    
   html[data-theme="light"] input[type="checkbox"] {
        filter: invert(1);
   }  

  ul:has(li > input) {
    list-style: none;
    padding-left: 0 !important;
  }
     

  /* ===== Copy-code icons ================================================== */

  .code-copy {
    position: absolute;
    top: calc(var(--g-sm));
    right: var(--g-xs);
    z-index: var(--z-mid);
  }

  /* quick “flash” feedback when something was copied */
  @keyframes flash {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.2);
    }
  }
  .flash {
    animation: flash 0.2s ease;
  }

  .markdown-alert p {
    margin: var(--g-sm) 0;
  }

  .markdown-alert {
    position: relative;
    padding-left: var(--g-lg);
    margin: var(--g-lg) 0;
  }

  .markdown-alert::before {
    content: "";
    position: absolute;
    top: var(--g-xs);
    bottom: 0;
    left: calc(var(--g-xs) * 2);
    width: 3px;
    opacity: 0.6;
    border-radius: var(--r-sm);
  }

  .markdown-alert svg {
    padding-top: var(--g-sm);
    fill: currentcolor;
  }

  .markdown-alert-note::before {
    background: var(--note);
  }
  .markdown-alert-note p:first-child {
    color: var(--note);
  }

  .markdown-alert-important::before {
    background: var(--important);
  }
  .markdown-alert-important p:first-child {
    color: var(--important);
  }

  .markdown-alert-tip::before {
    background: var(--tip);
  }
  .markdown-alert-tip p:first-child {
    color: var(--tip);
  }

  .markdown-alert-warning::before {
    background: var(--warning);
  }
  .markdown-alert-warning p:first-child {
    color: var(--warning);
  }

  .markdown-alert-caution::before {
    background: var(--caution);
  }
  .markdown-alert-caution p:first-child {
    color: var(--caution);
  }

  #see-also {
    color: var(--color-mid-contrast);
    margin-top: calc(var(--g-lg) * 2);
  }

  #see-also h2 {
    margin-bottom: var(--g-xs);
  }

  #see-also ul {
    padding-left: var(--g-lg);
  }

  /* ===== Copy-link icons on headings ===================================== */
  .heading-copy,
  .code-copy {
    opacity: 0.3;
    cursor: pointer;
    color: var(--color-text);
    background: none;
    border: none;
  }

  h1:hover .heading-copy,
  h2:hover .heading-copy,
  h3:hover .heading-copy,
  h4:hover .heading-copy,
  h5:hover .heading-copy,
  h6:hover .heading-copy, 
  pre:hover .code-copy {
    opacity: 1;
  }
}

/* ---------------------------------------------------------------------------
     5. MISC: scrollbars • fixes
     ------------------------------------------------------------------------ */
@layer misc {
  /* Custom scrollbars (WebKit only) */
  ::-webkit-scrollbar, code::-webkit-scrollbar {
    width: 25px;
    background: transparent !important;
  }

  ::-webkit-scrollbar-thumb, code::-webkit-scrollbar-thumb {
    background: var(--color-low-contrast);
    border-radius: 999px;
    border: 10px solid transparent;
    background-clip: padding-box !important;
  }

  ::-webkit-scrollbar-thumb:hover, code::-webkit-scrollbar-thumb:hover {
    background: var(--color-quarter-contrast);
  }
    
    input[type="search"]::-webkit-search-decoration,
    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-results-button,
    input[type="search"]::-webkit-search-results-decoration {
      -webkit-appearance:none;
    }  

  code::-webkit-scrollbar-thumb {
    border: 5px solid transparent;
  }
  
   details code::-webkit-scrollbar-thumb, code::-webkit-scrollbar-thumb {
    background: var(--color-low-contrast);
  }
    
  details code::-webkit-scrollbar-thumb {
    background: var(--color-quarter-contrast);
  }  

  details code::-webkit-scrollbar-thumb:hover {
    background: var(--color-mid-contrast);
  }  

  /* moz scrollbar patch */
  @-moz-document url-prefix() {
    :root {
      scrollbar-color: var(--color-mid-contrast) rgba(0, 0, 0, 0) !important;
      scrollbar-width: thin !important;
    }
  }
}

/* ---------------------------------------------------------------------------
     6. RESPONSIVE: burgers & slide-in panels (≤1000 px or portrait)
     ------------------------------------------------------------------------ */
@layer responsive {
  .theme-toggle, li.folder  {
    -webkit-tap-highlight-color: transparent;
  }

  .theme-toggle:focus:not(:focus-visible) {
    outline: none;
  }

  /* Burgers hidden on wide viewports */
  .burger {
    display: none;
    border: none;
    background: none;
    color: var(--color-text);
    cursor: pointer;
    padding: 4px;
  }

  @media (min-width: 1000px) {
    span#crumb-dyn {
      white-space: nowrap;
      max-width: 0px;
    }
  }

  @media (min-width: 1000px), (orientation: landscape) {
    #sidebar {
      display: flex;
    }
  }

  .burger:hover {
    color: var(--color-accent);
  }

  .panel-close {
    display: none;
  }

  @media (max-width: 1000px), (orientation: portrait) {
    
      iframe {
        width: 100%;
      }
     
     div#prev-next {
        display: flex;
         flex-direction: column;
        align-items: center;
        gap: var(--g-md);
    } 
      
     /* Show burgers */
    .burger {
      display: inline-flex;
      align-items: center;
    }

    /* Collapse panels by default */
    #sidebar,
    #util {
      display: none;
    }

    /* Full-viewport when opened via JS */
    #sidebar.open,
    #util.open {
      display: flex;
      flex-direction: column;
      width: 100dvw;
      padding-top: var(--h-header);

      position: fixed;
      inset: 0;
      z-index: var(--z-sky);
    }

    #util.open {
      background: var(--color-main);
      padding-left: var(--g-md);
    }

    #crumb-dyn {
      transform: translate(0px, 3px);
      height: 60%;
      max-width: 75dvw;
      margin-right: 10px;
      overflow-x: scroll;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      touch-action: pan-x;
      overscroll-behavior-y: contain;
      -webkit-mask-image: linear-gradient(
        to right,
        transparent 0,
        #000 var(--g-lg),
        #000 calc(100% - var(--g-lg)),
        transparent 100%
      );
      mask-image: linear-gradient(
        to right,
        transparent 0,
        #000 var(--g-lg),
        #000 calc(100% - var(--g-lg)),
        transparent 100%
      );
      -webkit-mask-size: 100% 100%;
      mask-size: 100% 100%;
    }

    #crumb-dyn a {
      padding: 0 var(--g-xs) var(--g-xs) var(--g-xs);
    }

    #crumb-dyn ul,
    #crumb-dyn .toggle {
      display: none;
    }

    #util {
      background: var(--color-main);
    }

    #crumb-dyn::-webkit-scrollbar {
      display: none;
    }

    /* Content column stacks when util is hidden */
    #content-area {
      flex-direction: column;
    }

    /* Close button for sliding panels */
    #util.open .panel-close,
    #sidebar.open .panel-close {
      display: block !important;
      position: absolute;
      top: 8px;
      right: 12px;
      font-weight: bolder !important;

      border: none;
      background: none;
      font: 2rem/1 monospace;
      color: var(--color-mid-contrast);
      cursor: pointer;
      z-index: calc(var(--z-menu) + 1);
    }

    .panel-close:hover {
      color: var(--color-accent);
    }
  }
}

/* ---------------------------------------------------------------------------
     7. GADGETS: effects
     ------------------------------------------------------------------------ */
@layer gadgets {
    
  #loading {
       max-width: fit-content;
       background: linear-gradient(
           130deg,
           var(--color-lowest-contrast) 5%,
           var(--color-quarter-contrast) 60%,
           var(--color-mid-contrast) 70%,
           var(--color-text) 85%,
           var(--color-lowest-contrast) 95%
       );
       background-size: 200% auto;
       background-clip: text;
       text-fill-color: transparent;
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       animation: loading 1.5s linear infinite;
    }
    @keyframes loading {
         to {
           background-position: -200% center;
         }
    }

        
  #crumb {
    box-shadow: var(--color-shadow) 3px -15px 30px 0px;
    clip-path: inset(0 0 -10000px 3px);
  }

  #sidebar {
    box-shadow: var(--color-shadow) -23px 4px 35px 0px;
  }

  #graph-box,
  #toc {
    box-shadow: var(--color-shadow) 3px 4px 23px -15px;
  }

  iframe,
  details,
  code,
  .katex-display .katex-html,
  #content img,
  table,
  .dropdown ul,
  #prev-next a,
  .dropdown ul,
  .childbox ul,
  header a:not(#home-link):hover {
    box-shadow: var(--color-shadow) 3px 4px 11px -9px;
  }

  #search {
    box-shadow: inset var(--color-shadow) 3px 4px 11px -10px;
  }

  button:hover svg,
  button:hover,
  circle:hover,
  #home-link:hover svg,
  #results .heading-result:hover,
  #search-clear:hover,
  #search-clear:focus,
  .childbox .toggle:hover,
  a.watermark:hover {
    fill: var(--color-accent);
    stroke: var(--color-accent);
    color: var(--color-accent);
  }

  .sidebar-current,
  .toc-current {
    color: var(--color-accent);
    font-weight: 600;
  }

  details:not([open]):hover {
    animation: shake 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    transform: translate3d(0, 0, 0);
    perspective: 1000px;
  }

  @keyframes shake {
    10%,
    90% {
      transform: translate3d(-1px, 0, 0);
    }
    20%,
    80% {
      transform: translate3d(1px, 0, 0);
    }

    30%,
    50%,
    70% {
      transform: translate3d(-1px, 0, 0);
    }
    40%,
    60% {
      transform: translate3d(1px, 0, 0);
    }
  }
  /* ===== easter egg ===== */
  a.watermark {
    position: relative;
    z-index: 0;
  }

  a.watermark::before {
    content: "";
    position: absolute;
    inset: -0.55em;
    background: radial-gradient(
      circle,
      var(--color-accent) 0%,
      rgba(0, 0, 0, 0) 50%
    );
    opacity: 0;
  }

  @keyframes charge {
    0% {
      opacity: 0;
      transform: scale(0);
      filter: blur(1px);
    }
    80% {
      opacity: 0.5;
      transform: scale(1.2);
      filter: blur(9px);
    }
    100% {
      opacity: 1;
      transform: scale(40);
      filter: blur(12px);
    }
  }

  a.watermark:hover::before {
    animation: charge 13s cubic-bezier(0.2, 0.6, 0.3, 1) forwards;
  }
}
